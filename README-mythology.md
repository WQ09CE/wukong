# Wukong 悟空 (神话版)

> 基于六根分身的 AI Agent 多智能体协作系统
>
> "六根并行生产；戒定慧识四大护航；PreCompact 自动沉淀。"

**[English / Engineering Version](README.md)** - Formal system engineering terminology

**Wukong** 将 Claude Code 转化为高效的工程团队。本体专注用户交互，六根分身并行执行专业任务。

## 核心架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户 (User)                               │
└───────────────────────────┬─────────────────────────────────────┘
                            │ /wukong 命令
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                      悟空本体 (Coordinator)                       │
│  • 用户交互  • 轨道选择  • 分身调度  • 结果验证  • 进度汇报        │
└───────────────────────────┬─────────────────────────────────────┘
                            │ Task() 召唤
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    六根分身 (Six Roots Avatars)                   │
│   👁️眼      👂耳      👃鼻      👅舌      ⚔️身       🧠意        │
│   探索      需求      审查      测试      实现       设计        │
└───────────────────────────┬─────────────────────────────────────┘
                            │ 输出
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                   戒定慧识 (Four Pillars)                        │
│   ⛔戒 ────→ 🎯定 ────→ 💡慧 ────→ 📚识                         │
│   规则检查    可复现      反思沉淀    存储反馈                    │
└─────────────────────────────────────────────────────────────────┘
```

## 六根分身系统

> **六根**源自佛教，指眼、耳、鼻、舌、身、意六种感知器官。

| 六根 | 分身 | 能力 | 后台 | Do | Don't |
|------|------|------|------|-----|-------|
| 👁️眼 | 眼分身 | 探索·搜索 | ✓ | 搜索、定位 | 修改代码 |
| 👂耳 | 耳分身 | 需求·理解 | - | 澄清需求、AC | 实现设计 |
| 👃鼻 | 鼻分身 | 审查·检测 | ✓ | 审查、扫描 | 修复代码 |
| 👅舌 | 舌分身 | 测试·文档 | - | 写测试文档 | 实现功能 |
| ⚔️身 | 斗战胜佛 | 实现·行动 | - | 写代码修复 | 跳过测试 |
| 🧠意 | 意分身 | 设计·决策 | - | 架构设计 | 写实现 |

**职能三件套**: 每个分身强制定义 **职责边界** + **输出契约** + **工具权限**

## 戒定慧识四大模块

```
分身输出 ──→ ⛔戒 ──→ 🎯定 ──→ 💡慧 ──→ 📚识
            规则检查   可复现    反思沉淀   存储反馈
```

| 模块 | 职责 | 关键规则 |
|------|------|----------|
| ⛔ 戒 | 规则检查 | Contract 完整性、Do/Don't 边界、安全检查 |
| 🎯 定 | 可复现验证 | L0推测❌ → L1引用⚠️ → L2本地✅ → L3集成✅✅ |
| 💡 慧 | 反思沉淀 | 末那识扫描、锚点提取、PreCompact Hook |
| 📚 识 | 存储反馈 | 三态上下文、锚点索引、T1/T2惯性提示 |

**惯性提示 (识→六根反馈)**:
- **T1** (任务启动前): 查询 P/C/M 锚点 → 风险预警、约束提醒
- **T2** (方案冻结后): 查询 D/I 锚点 → 历史决策、回滚经验

## 锚点系统

| 类型 | 前缀 | 说明 | 示例 |
|------|------|------|------|
| 决策 | D | 架构/技术决策 | [D001] 采用六根分身模型 |
| 约束 | C | 必须遵守的规则 | [C001] 输出必须脱敏 |
| 接口 | I | 关键接口定义 | [I001] Sanitizer.sanitize() |
| 问题 | P | 已知问题/陷阱 | [P001] 串行执行反模式 |
| 模式 | M | 可复用模式 | [M001] Repository 模式 |

## 安装

### Linux / macOS

```bash
# 克隆并安装
git clone https://github.com/WQ09CE/wukong.git
cd wukong
./install.sh /path/to/your/project

# 或安装到当前目录
./install.sh
```

### Windows (PowerShell)

```powershell
# 克隆并安装
git clone https://github.com/WQ09CE/wukong.git
cd wukong
.\install.ps1 -TargetDir "C:\path\to\your\project"

# 或安装到当前目录
.\install.ps1
```

安装器会自动：
1. 复制规则、技能、命令到 `.claude/`
2. 安装 hooks 到 `~/.wukong/hooks/`
3. 注册 hooks 到 `~/.claude/settings.json`（需确认）

## 使用

### 基本命令

```bash
# 激活悟空
/wukong 你好

# 自动轨道选择
/wukong 添加用户登录功能    # → Feature Track
/wukong 修复支付模块 bug    # → Fix Track
/wukong 重构认证代码        # → Refactor Track
```

### 显式指定分身 (@语法)

```bash
/wukong @眼 探索项目结构
/wukong @意 设计缓存方案
/wukong @斗战胜佛 实现登录功能
/wukong @鼻 审查这个 PR
```

| @ 标记 | 分身 | 英文别名 |
|--------|------|----------|
| `@眼` | 眼分身 | `@explorer` |
| `@耳` | 耳分身 | `@analyst` |
| `@鼻` | 鼻分身 | `@reviewer` |
| `@舌` | 舌分身 | `@tester` |
| `@身` / `@斗战胜佛` | 斗战胜佛 | `@impl` |
| `@意` | 意分身 | `@architect` |

### 上下文管理

| 命令 | 动作 |
|------|------|
| `/wukong 内观` | 慧模块反思 + 提取锚点 |
| `/wukong 压缩` | 生成缩形态摘要 (<500字) |
| `/wukong 存档` | 保存到 sessions/ |
| `/wukong 加载 {name}` | 恢复历史会话 |
| `/wukong 锚点` | 显示所有锚点 |

**三态形态**: 🔶巨(完整) → 🔹常(结构化) → 🔸缩(<500字)

## 目录结构

```
项目根目录/
├── .claude/                    # Claude Code 配置
│   ├── rules/                  # 规则 (自动加载)
│   │   └── 00-wukong-core.md  # 核心规则
│   ├── skills/                 # 分身技能
│   └── commands/               # 命令
│       └── wukong.md          # /wukong 命令
│
└── .wukong/                   # Wukong 数据
    ├── context/               # 上下文存储
    │   ├── anchors.md        # 锚点索引
    │   ├── index.json        # 会话索引
    │   └── sessions/         # 历史存档
    ├── notepads/             # 记事本
    └── plans/                # 计划文档

~/.wukong/                    # 全局配置
└── hooks/
    └── hui-extract.py       # 慧模块 PreCompact Hook
```

## 筋斗云 (并行执行)

- **最大并行**: 3-4 个分身
- **强制并行**: 修改 ≥2 个独立文件 → 每文件一个分身
- **禁止**: 把多个独立任务打包给一个分身

**召唤前自检**: "这个任务能拆成并行吗？"

## 紧箍咒 (约束)

**NEVER**:
- 跳过验证 / 未读代码就修改
- 本体写大量代码 (>10行)
- 串行执行可并行任务
- 违反分身职责边界

**ALWAYS**:
- 验证分身输出
- 保持构建/测试通过
- 分身输出后执行戒定慧检查

## 详细文档

- [系统架构总览](.wukong/plans/wukong-system-overview.md)
- [核心规则](.claude/rules/00-wukong-core.md)
- [分身技能](.claude/skills/)

## 参考项目

- [oh-my-opencode](https://github.com/code-yeongyu/oh-my-opencode) - OpenCode 配置框架
- [claude-code-settings](https://github.com/feiskyer/claude-code-settings) - Claude Code 设置最佳实践

## License

MIT

---

> *"吾乃齐天大圣孙悟空，筋斗云十万八千里，七十二变随心所欲。"*
