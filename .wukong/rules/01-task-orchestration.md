# Task Orchestration Protocol (ä»»åŠ¡ç¼–æ’åè®®)

## Pre-Delegation Declaration (å¬å”¤åˆ†èº«å‰å£°æ˜)

**BEFORE EVERY Avatar summoning, declare:**

```
æˆ‘å°†å¬å”¤åˆ†èº«:
- **å…­æ ¹**: [çœ¼/è€³/é¼»/èˆŒ/èº«/æ„/è¶…è¶Šå…­æ ¹]
- **Avatar**: [çœ¼åˆ†èº«/è€³åˆ†èº«/é¼»åˆ†èº«/èˆŒåˆ†èº«/æ–—æˆ˜èƒœä½›/æ„åˆ†èº«/å†…è§‚æ‚Ÿç©º]
- **Reason**: [ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªåˆ†èº«]
- **Expected Outcome**: [æœŸæœ›çš„äº¤ä»˜ç‰©]
- **Background**: [true/false - æ˜¯å¦åå°è¿è¡Œ]
```

**æœ¬ä½“èŒè´£æé†’**:
- æœ¬ä½“ä¸“æ³¨äºç”¨æˆ·äº¤äº’ï¼Œä¸ç›´æ¥å†™å¤§é‡ä»£ç 
- ä»£ç å®ç°äº¤ç»™æ–—æˆ˜èƒœä½› (èº«)
- æœ¬ä½“è´Ÿè´£ç›‘ç£ã€éªŒè¯ã€æ±‡æŠ¥

## Avatar Selection Decision Tree (å…­æ ¹é€‰æ‹©å†³ç­–æ ‘)

```
1. æ˜¯ä»£ç æ¢ç´¢/ä¿¡æ¯æœç´¢/ç ”ç©¶ä»»åŠ¡?
   âœ“ YES â†’ ğŸ‘ï¸ çœ¼åˆ†èº« (è§‚) - background=true
   âœ— NO â†’ Continue

2. æ˜¯éœ€æ±‚åˆ†æ/æ¾„æ¸…/ç†è§£ç”¨æˆ·æ„å›¾ä»»åŠ¡?
   âœ“ YES â†’ ğŸ‘‚ è€³åˆ†èº« (å¬)
   âœ— NO â†’ Continue

3. æ˜¯ä»£ç å®¡æŸ¥/è´¨é‡æ£€æŸ¥/å®‰å…¨æ‰«æä»»åŠ¡?
   âœ“ YES â†’ ğŸ‘ƒ é¼»åˆ†èº« (è§‰) - background=true
   âœ— NO â†’ Continue

4. æ˜¯æµ‹è¯•ç¼–å†™/æ–‡æ¡£ç”Ÿæˆ/æŠ¥å‘Šè¾“å‡ºä»»åŠ¡?
   âœ“ YES â†’ ğŸ‘… èˆŒåˆ†èº« (è¨€)
   âœ— NO â†’ Continue

5. æ˜¯ä»£ç å®ç°/ç¼–å†™/å¼€å‘/ä¿®å¤ä»»åŠ¡?
   âœ“ YES â†’ âš”ï¸ æ–—æˆ˜èƒœä½› (è¡Œ)
   âœ— NO â†’ Continue

6. æ˜¯æ¶æ„/è®¾è®¡/æŠ€æœ¯é€‰å‹/å†³ç­–ä»»åŠ¡?
   âœ“ YES â†’ ğŸ§  æ„åˆ†èº« (æ€)
   âœ— NO â†’ Continue

7. æ˜¯æµç¨‹åæ€/é”šç‚¹ç»´æŠ¤/ä¸Šä¸‹æ–‡ç®¡ç†ä»»åŠ¡?
   âœ“ YES â†’ ğŸ”® å†…è§‚æ‚Ÿç©º (è¶…è¶Šå…­æ ¹)
   âœ— NO â†’ Continue

8. æ˜¯ç”¨æˆ·å¯¹è¯/é—®ç­”/ç®€å•ä»»åŠ¡?
   âœ“ YES â†’ æœ¬ä½“ç›´æ¥å¤„ç†
```

**å…­æ ¹å¿«é€Ÿå¯¹ç…§è¡¨:**

| å…­æ ¹ | åˆ†èº« | èƒ½åŠ›ç»´åº¦ | Background? |
|------|------|----------|-------------|
| çœ¼ | çœ¼åˆ†èº« | è§‚å¯ŸÂ·æ¢ç´¢Â·æœç´¢ | Yes |
| è€³ | è€³åˆ†èº« | å€¾å¬Â·ç†è§£Â·éœ€æ±‚ | No |
| é¼» | é¼»åˆ†èº« | æ„ŸçŸ¥Â·å®¡æŸ¥Â·æ£€æµ‹ | Yes |
| èˆŒ | èˆŒåˆ†èº« | è¡¨è¾¾Â·æ²Ÿé€šÂ·æ–‡æ¡£ | No |
| èº« | æ–—æˆ˜èƒœä½› | æ‰§è¡ŒÂ·å®ç°Â·è¡ŒåŠ¨ | No |
| æ„ | æ„åˆ†èº« | æ€è€ƒÂ·è®¾è®¡Â·å†³ç­– | No |
| - | å†…è§‚æ‚Ÿç©º | åæ€Â·é”šç‚¹Â·å¥åº· | No |

## Introspection Protocol (å†…è§‚åè®®)

> å¾æ—¥ä¸‰çœå¾èº« - å¤æ‚ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œæ·±åº¦åæ€ã€‚
> åŸºäº feiskyer/claude-code-settings çš„ reflection-harder æ¡†æ¶å¢å¼ºã€‚
> **ä¸å¦‚æ„é‡‘ç®æ£’åè®®é›†æˆ** - å†…è§‚æ—¶åŒæ­¥ç»´æŠ¤é”šç‚¹å’Œä¸Šä¸‹æ–‡å¥åº·åº¦ã€‚

### ä½•æ—¶å¬å”¤å†…è§‚æ‚Ÿç©º

| è§¦å‘æ¡ä»¶ | å†…è§‚æ·±åº¦ | è¯´æ˜ |
|----------|----------|------|
| å¤æ‚ä»»åŠ¡å®Œæˆ | æ·±åº¦ | å¤šåˆ†èº«åä½œçš„ä»»åŠ¡ |
| ä»»åŠ¡å¤±è´¥/é‡åš | æ·±åº¦ | åˆ†æå¤±è´¥åŸå›  |
| ç”¨æˆ·ä¸»åŠ¨è¯·æ±‚ | æŒ‰éœ€ | "åæ€ä¸€ä¸‹"ã€"æ€»ç»“ç»éªŒ"ã€"å†…è§‚" |
| ç®€å•ä»»åŠ¡å®Œæˆ | è·³è¿‡ | ä¸éœ€è¦å†…è§‚ |
| å‘ç°é‡è¦æ¨¡å¼ | æ ‡å‡† | å€¼å¾—æ²‰æ·€çš„ç»éªŒ |
| **ä¸Šä¸‹æ–‡ > 75%** | **æ ‡å‡†** | **å­˜æ¡£å‰åæ€ï¼Œæå–é”šç‚¹** |
| **ä¼šè¯å³å°†ç»“æŸ** | **å¿«é€Ÿ** | **ç¡®ä¿è·¨ä¼šè¯ä¼ é€’å°±ç»ª** |

### å†…è§‚æ·±åº¦

```
å¿«é€Ÿå†…è§‚ (1-2 åˆ†é’Ÿ):
â”œâ”€â”€ ä¸»è¦é—®é¢˜è¯†åˆ«
â”œâ”€â”€ 1-2 æ¡æ”¹è¿›å»ºè®®
â””â”€â”€ é€‚ç”¨: ç®€å•ä»»åŠ¡

æ ‡å‡†å†…è§‚ (3-5 åˆ†é’Ÿ):
â”œâ”€â”€ 3-4 ç»´åº¦åˆ†æ
â”œâ”€â”€ ç»“æ„åŒ–æŠ¥å‘Š
â”œâ”€â”€ æ¨¡å¼æç‚¼
â””â”€â”€ é€‚ç”¨: å¸¸è§„ä»»åŠ¡

æ·±åº¦å†…è§‚ (5-10 åˆ†é’Ÿ):
â”œâ”€â”€ å…¨ 6 ç»´åº¦åˆ†æ
â”‚   â”œâ”€â”€ é—®é¢˜ä¸è§£å†³
â”‚   â”œâ”€â”€ ä»£ç æ¨¡å¼ä¸æ¶æ„
â”‚   â”œâ”€â”€ ç”¨æˆ·åå¥½ä¸å·¥ä½œæµ
â”‚   â”œâ”€â”€ ç³»ç»Ÿç†è§£
â”‚   â”œâ”€â”€ çŸ¥è¯†ç¼ºå£ä¸æ”¹è¿›
â”‚   â””â”€â”€ ğŸ†• ä¸Šä¸‹æ–‡ä¸é”šç‚¹å¥åº·åº¦
â”œâ”€â”€ å®Œæ•´åæ€æŠ¥å‘Š
â”œâ”€â”€ æ›´æ–° notepads/learnings.md
â”œâ”€â”€ ç”Ÿæˆè¡ŒåŠ¨é¡¹
â”œâ”€â”€ ğŸ†• æå–å¹¶åˆ›å»ºé”šç‚¹ [D]/[C]/[I]/[P]/[U]
â”œâ”€â”€ ğŸ†• éªŒè¯ç°æœ‰é”šç‚¹æœ‰æ•ˆæ€§
â”œâ”€â”€ ğŸ†• ç”Ÿæˆä¸‰æ€æ‘˜è¦ (ç¼©/å¸¸/å·¨)
â””â”€â”€ é€‚ç”¨: å¤æ‚ä»»åŠ¡/å¤±è´¥åˆ†æ
```

### å†…è§‚è¾“å‡ºè¦æ±‚

```
1. ä¼šè¯æ¦‚è§ˆ
   - ç›®æ ‡ã€ç»“æœã€æŒç»­æ—¶é—´

2. é—®é¢˜è§£å†³è®°å½•
   - ç”¨æˆ·å½±å“ â†’ æŠ€æœ¯åŸå›  â†’ è§£å†³æ–¹æ¡ˆ â†’ å­¦ä¹ 

3. å»ºç«‹çš„æ¨¡å¼
   - å¯å¤ç”¨æ¨¡å¼æç‚¼ï¼Œå¸¦ç¤ºä¾‹å’Œé€‚ç”¨åœºæ™¯

4. ç”¨æˆ·åå¥½
   - å¸¦è¯æ®å¼•ç”¨çš„åå¥½è®°å½•

5. æ”¹è¿›æœºä¼š
   - ç«‹å³å¯è¡Œ vs æœªæ¥ä¼˜åŒ–

6. è¡ŒåŠ¨é¡¹
   - å…·ä½“ã€å¯æ‰§è¡Œçš„åç»­æ­¥éª¤
```

### å†…è§‚åŸåˆ™

```
âœ… æ­£ç¡®çš„å†…è§‚:
â”œâ”€â”€ æç‚¼å¯å¤ç”¨æ¨¡å¼
â”œâ”€â”€ è®°å½•ç”¨æˆ·å·¥ä½œé£æ ¼
â”œâ”€â”€ ç´¯ç§¯çŸ¥è¯†è®©åç»­æ›´é«˜æ•ˆ
â”œâ”€â”€ è¯†åˆ«å·¥ä½œæµä¼˜åŒ–æœºä¼š
â”œâ”€â”€ æ˜ç¡®è‡ªä¸»è¾¹ç•Œ
â””â”€â”€ å°†å­¦ä¹ æ²‰æ·€åˆ° notepads/

âŒ é”™è¯¯çš„å†…è§‚:
â”œâ”€â”€ åªæ‰¹è¯„ä¸è‚¯å®š
â”œâ”€â”€ æ³›æ³›è€Œè°ˆæ— æ³•æ‰§è¡Œ
â”œâ”€â”€ ä¸ºäº†åæ€è€Œåæ€
â”œâ”€â”€ å¿½è§†æˆåŠŸç»éªŒ
â””â”€â”€ ä¸äº§å‡ºå¯å¤ç”¨çŸ¥è¯†
```

### å†…è§‚åçš„çŸ¥è¯†æ²‰æ·€

```
å†…è§‚å®Œæˆåï¼Œå¿…é¡»æ›´æ–°çŸ¥è¯†åº“:
â”œâ”€â”€ notepads/{plan}/learnings.md  â† ç»éªŒæ•™è®­
â”œâ”€â”€ notepads/{plan}/decisions.md  â† é‡è¦å†³ç­–
â”œâ”€â”€ notepads/{plan}/issues.md     â† é—®é¢˜è®°å½•
â””â”€â”€ notepads/{plan}/breakthroughs.md â† çªç ´è®°å½• (å¦‚æœ‰)
```

### å†…è§‚ä¸é‡‘ç®æ£’åè®®é›†æˆ

```
å†…è§‚å®Œæˆåï¼Œå¿…é¡»ç»´æŠ¤ä¸Šä¸‹æ–‡ç³»ç»Ÿ:

1. é”šç‚¹æå–
   â”œâ”€â”€ æ‰«ææœ¬æ¬¡ä¼šè¯çš„å…³é”®ä¿¡æ¯
   â”œâ”€â”€ åˆ›å»ºæ–°é”šç‚¹ â†’ è¿½åŠ åˆ° context/anchors.md
   â””â”€â”€ ç±»å‹: [D]å†³ç­– [C]çº¦æŸ [I]æ¥å£ [P]é—®é¢˜ [U]åå¥½

2. é”šç‚¹éªŒè¯
   â”œâ”€â”€ æ£€æŸ¥ anchors.md ä¸­çš„ç°æœ‰é”šç‚¹
   â”œâ”€â”€ æ ‡è®°è¿‡æœŸé”šç‚¹ âŒ
   â”œâ”€â”€ æ›´æ–°éœ€ä¿®æ”¹çš„é”šç‚¹ âš ï¸
   â””â”€â”€ ç¡®è®¤æœ‰æ•ˆé”šç‚¹ âœ…

3. ä¸‰æ€å­˜æ¡£
   â”œâ”€â”€ context/current/compact.md  â† ğŸ”¸ ç¼©å½¢æ€æ‘˜è¦
   â”œâ”€â”€ context/current/normal.md   â† ğŸ”¹ å¸¸å½¢æ€æ‘˜è¦
   â””â”€â”€ context/current/expanded.md â† ğŸ”¶ å®Œæ•´å†…è§‚æŠ¥å‘Š

4. ä¸Šä¸‹æ–‡å¥åº·è¯„ä¼°
   â”œâ”€â”€ é”šç‚¹è¦†ç›–åº¦: å…³é”®ä¿¡æ¯æ˜¯å¦éƒ½æœ‰é”šç‚¹
   â”œâ”€â”€ ä¿¡æ¯å¯†åº¦: æ˜¯å¦æœ‰å¯å‹ç¼©çš„å†—ä½™
   â””â”€â”€ è·¨ä¼šè¯å°±ç»ª: æ˜¯å¦å¯ä»¥å®‰å…¨ç»“æŸä¼šè¯
```

### å†…è§‚è§¦å‘çš„å­˜æ¡£æµç¨‹

```
å½“å†…è§‚æ£€æµ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè§¦å‘å­˜æ¡£:

ä¸Šä¸‹æ–‡ > 75%:
â”œâ”€â”€ 1. ç”Ÿæˆä¸‰æ€æ‘˜è¦
â”œâ”€â”€ 2. å°† current/ ç§»åŠ¨åˆ° sessions/{date}-{name}/
â”œâ”€â”€ 3. åˆ›å»ºæ–°çš„ current/ ä½¿ç”¨ compact.md
â””â”€â”€ 4. é€šçŸ¥ç”¨æˆ·: "ä¸Šä¸‹æ–‡å·²å­˜æ¡£ï¼Œå¯å®‰å…¨ç»§ç»­"

ä¼šè¯å³å°†ç»“æŸ:
â”œâ”€â”€ 1. å¿«é€Ÿå†…è§‚
â”œâ”€â”€ 2. ç¡®ä¿å…³é”®é”šç‚¹å·²æå–
â”œâ”€â”€ 3. ç”Ÿæˆ compact.md ä¾›ä¸‹æ¬¡ä½¿ç”¨
â””â”€â”€ 4. æç¤º: "ä¸‹æ¬¡å¯ä»¥è¯´'ç»§ç»­{ä»»åŠ¡}'åŠ è½½ä¸Šä¸‹æ–‡"
```

## Task Prompt Template

```markdown
## ä»»åŠ¡ (TASK)
[å…·ä½“ã€å¯è¡¡é‡çš„ç›®æ ‡]

## èƒŒæ™¯ (CONTEXT)
- æŠ€æœ¯æ ˆ: [C++/Python/FastAPI/...]
- ç›¸å…³æ–‡ä»¶: [file paths]
- ç°æœ‰æ¨¡å¼: [patterns to follow]

## æœŸæœ›äº§å‡º (EXPECTED OUTCOME)
- [ ] [å…·ä½“äº¤ä»˜ç‰© 1]
- [ ] [å…·ä½“äº¤ä»˜ç‰© 2]
- [ ] [æˆåŠŸæ ‡å‡†]

## å¿…é¡»åš (MUST DO)
- [éµå¾ªçš„è§„èŒƒ]
- [å‚è€ƒçš„æ–‡ä»¶/æ¨¡å—]
- [æ€§èƒ½è¦æ±‚]

## ç¦æ­¢åš (MUST NOT DO)
- [ç¦æ­¢çš„åæ¨¡å¼]
- [é¿å…çš„æŠ€æœ¯å€º]
```

## æ¥å£å¥‘çº¦æ–‡æ¡£ (Interface Contract)

> **å¹¶è¡Œå®ç°å‰ï¼Œå¿…é¡»å…ˆå®šä¹‰æ¥å£å¥‘çº¦ï¼Œé¿å…é›†æˆæ—¶çš„æ¥å£ä¸åŒ¹é…é—®é¢˜ã€‚**

### ä½•æ—¶éœ€è¦æ¥å£å¥‘çº¦

| åœºæ™¯ | æ˜¯å¦éœ€è¦ | åŸå›  |
|------|----------|------|
| å¤šä¸ªæ¨¡å—å¹¶è¡Œå®ç° | âœ… å¿…é¡» | ç¡®ä¿æ¥å£ä¸€è‡´ |
| å•æ¨¡å—å®ç° | âŒ ä¸éœ€è¦ | æ— å¹¶è¡Œé›†æˆé£é™© |
| å·²æœ‰å‚è€ƒå®ç° | âš ï¸ å¯é€‰ | å¯ä»å‚è€ƒä»£ç æ¨æ–­ |

### å¥‘çº¦æ–‡æ¡£ä½ç½®

```
.wukong/notepads/{plan}/interfaces.md
```

### å¥‘çº¦æ–‡æ¡£æ ¼å¼

```markdown
# æ¥å£å¥‘çº¦: {Project Name}

## æ¨¡å—ä¾èµ–å›¾
```
A â”€â”€â†’ C
B â”€â”€â†’ C
```

## æ¨¡å—æ¥å£å®šä¹‰

### ModuleA (credentials.py)

```python
class Credentials:
    @staticmethod
    def get_git_token() -> Optional[str]:
        """è·å– Git Tokenï¼Œè¿”å› None è¡¨ç¤ºæœªé…ç½®"""
        ...

    @staticmethod
    def get_ollama_config() -> dict:
        """è¿”å› {"url": str, "model": str, "timeout": int}"""
        ...
```

### ModuleB (sanitizer.py)

```python
class Sanitizer:
    @classmethod
    def sanitize(cls, data: Any) -> Any:
        """é€’å½’è„±æ•ï¼Œç§»é™¤æ•æ„Ÿå­—æ®µ"""
        ...
```

## é”™è¯¯å¤„ç†çº¦å®š

| æ¨¡å— | é”™è¯¯å¤„ç†æ–¹å¼ |
|------|-------------|
| credentials | è¿”å› None æˆ– é»˜è®¤å€¼ |
| tools | è¿”å› {"error": str} |
| agent | æŠ›å‡º RuntimeError |
| server | æŠ›å‡º HTTPException |

## æ•°æ®æµ

```
ç”¨æˆ·è¯·æ±‚ â†’ Server â†’ Agent â†’ Tools â†’ è¿”å›è„±æ•ç»“æœ
```
```

### å¥‘çº¦ç”Ÿæˆæ—¶æœº

```
è®¾è®¡é˜¶æ®µ (æ¶æ„æ‚Ÿç©º):
â”œâ”€â”€ 1. ç¡®å®šæ¨¡å—åˆ’åˆ†
â”œâ”€â”€ 2. å®šä¹‰æ¨¡å—æ¥å£
â”œâ”€â”€ 3. ç”Ÿæˆ interfaces.md
â””â”€â”€ 4. åˆ†å‘ç»™å„æ–—æˆ˜èƒœä½›

å®ç°é˜¶æ®µ (æ–—æˆ˜èƒœä½›):
â”œâ”€â”€ 1. é˜…è¯» interfaces.md
â”œâ”€â”€ 2. ä¸¥æ ¼æŒ‰æ¥å£å®ç°
â””â”€â”€ 3. ä¸å¾—æ“…è‡ªä¿®æ”¹æ¥å£
```

## Parallel Execution Strategy (ç­‹æ–—äº‘å¹¶è¡Œç­–ç•¥)

> **ç­‹æ–—äº‘**: ä¸€ä¸ªç­‹æ–—åä¸‡å…«åƒé‡Œã€‚åˆ†èº«æœ¯çš„ç²¾é«“åœ¨äº**åŒæ—¶å‡ºå‡»**ï¼Œè€Œéæ’é˜Ÿç­‰å€™ã€‚

### The Parallelization Decision Tree (å¹¶è¡Œå†³ç­–æ ‘)

```
å¼€å§‹ä»»åŠ¡åˆ†æ
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q1: ä»»åŠ¡å¯ä»¥åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹å­ä»»åŠ¡å—ï¼Ÿ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€ NO â†’ å•åˆ†èº«ä¸²è¡Œæ‰§è¡Œ
     â”‚
     â–¼ YES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q2: å­ä»»åŠ¡ä¹‹é—´æœ‰æ•°æ®ä¾èµ–å—ï¼Ÿ               â”‚
â”‚     (ä¸€ä¸ªçš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ªçš„è¾“å…¥)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€ YES â†’ æŒ‰ä¾èµ–é¡ºåºä¸²è¡Œ
     â”‚
     â–¼ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q3: å­ä»»åŠ¡ä¼šä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶å—ï¼Ÿ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€ YES â†’ ä¸²è¡Œæ‰§è¡Œï¼ˆé¿å…å†²çªï¼‰
     â”‚
     â–¼ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… å¯ä»¥å¹¶è¡Œï¼å¬å”¤å¤šä¸ªåˆ†èº«åŒæ—¶æ‰§è¡Œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Parallelization Patterns (å¹¶è¡Œæ¨¡å¼)

#### Pattern 1: **åˆ†èº«ç¾¤æ”»** (Multi-Module Implementation)
**åœºæ™¯**: å®ç°å¤šä¸ªç‹¬ç«‹æ¨¡å—ï¼ˆæ— ç›¸äº’ä¾èµ–ï¼‰
**åŠ é€Ÿæ¯”**: ç†è®º Nxï¼ˆN = æ¨¡å—æ•°ï¼‰

```
è®¾è®¡å®Œæˆå:
     â”‚
     â”œâ”€â”€â†’ [æ–—æˆ˜èƒœä½› A] å®ç° module_a.py  â”€â”€â”
     â”œâ”€â”€â†’ [æ–—æˆ˜èƒœä½› B] å®ç° module_b.py  â”€â”€â”¼â”€â”€â†’ åˆå¹¶éªŒè¯
     â””â”€â”€â†’ [æ–—æˆ˜èƒœä½› C] å®ç° module_c.py  â”€â”€â”˜

# å¬å”¤æ–¹å¼ (åœ¨åŒä¸€æ¡æ¶ˆæ¯ä¸­å‘é€å¤šä¸ª Task)
Task(subagent_type="general-purpose", prompt="å®ç° module_a", run_in_background=true)
Task(subagent_type="general-purpose", prompt="å®ç° module_b", run_in_background=true)
Task(subagent_type="general-purpose", prompt="å®ç° module_c", run_in_background=true)
```

#### Pattern 2: **ä¾¦å¯Ÿå…µ + ä¸»åŠ›å†›** (Scout & Infantry)
**åœºæ™¯**: å®ç°åŠŸèƒ½æ—¶éœ€è¦ä¸æ–­æŸ¥é˜…å‚è€ƒ
**åŠ é€Ÿæ¯”**: å‡å°‘ç­‰å¾…æ—¶é—´

```
å¼€å§‹å®ç°:
     â”‚
     â”œâ”€â”€â†’ [çœ¼åˆ†èº«] ç ”ç©¶ç›¸å…³ API å’Œæ¨¡å¼ (åå°)
     â”‚         â”‚
     â”‚         â””â”€â”€â†’ æŒç»­æä¾›å‚è€ƒä¿¡æ¯
     â”‚
     â””â”€â”€â†’ [æ–—æˆ˜èƒœä½›] å¼€å§‹å®ç°ä»£ç 
               â”‚
               â””â”€â”€â†’ é‡åˆ°ä¸ç¡®å®šæ—¶ï¼Œä»çœ¼åˆ†èº«è·å–ç­”æ¡ˆ

# å¬å”¤æ–¹å¼
Task(subagent_type="Explore", prompt="ç ”ç©¶ X åº“çš„ç”¨æ³•å’Œæœ€ä½³å®è·µ", run_in_background=true)
Task(subagent_type="general-purpose", prompt="å®ç° Y åŠŸèƒ½ï¼Œå‚è€ƒçœ¼åˆ†èº«çš„å‘ç°")
```

#### Pattern 3: **TDD é’³å½¢æ”»åŠ¿** (Test + Implement Pincer)
**åœºæ™¯**: æ¥å£å·²æ˜ç¡®å®šä¹‰ï¼ˆè®¾è®¡æ–‡æ¡£/å¤´æ–‡ä»¶ï¼‰
**åŠ é€Ÿæ¯”**: ~2x

```
æ¥å£å®šä¹‰å®Œæˆ:
     â”‚
     â”œâ”€â”€â†’ [èˆŒåˆ†èº«] æ ¹æ®æ¥å£ç¼–å†™æµ‹è¯• (åå°)
     â”‚
     â””â”€â”€â†’ [æ–—æˆ˜èƒœä½›] å®ç°æ¥å£ (åå°)
               â”‚
               â–¼
          [åˆå¹¶] â†’ è¿è¡Œæµ‹è¯• â†’ éªŒè¯

# å¬å”¤æ–¹å¼
Task(subagent_type="general-purpose", prompt="æ ¹æ®æ¥å£å®šä¹‰ç¼–å†™æµ‹è¯•", run_in_background=true)
Task(subagent_type="general-purpose", prompt="å®ç°æ¥å£", run_in_background=true)
# ç­‰å¾…ä¸¤è€…å®Œæˆåè¿è¡Œæµ‹è¯•
```

#### Pattern 4: **ä»£ç  + é…ç½®å¹¶è¡Œ** (Code + Config Parallel)
**åœºæ™¯**: å®ç°ä»£ç çš„åŒæ—¶å‡†å¤‡éƒ¨ç½²é…ç½®
**åŠ é€Ÿæ¯”**: ~1.5x

```
è®¾è®¡å®Œæˆå:
     â”‚
     â”œâ”€â”€â†’ [æ–—æˆ˜èƒœä½›] å®ç°æ ¸å¿ƒä»£ç 
     â”‚
     â””â”€â”€â†’ [æ„åˆ†èº«] å‡†å¤‡ Dockerfile / CI é…ç½® (åå°)
               â”‚
               â””â”€â”€â†’ å®¹å™¨é…ç½®ä¸ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚

# å¬å”¤æ–¹å¼
Task(subagent_type="general-purpose", prompt="å®ç°æ ¸å¿ƒåŠŸèƒ½ä»£ç ")
Task(subagent_type="general-purpose", prompt="å‡†å¤‡ Dockerfile å’Œ docker-compose", run_in_background=true)
```

#### Pattern 5: **èœ‚ç¾¤æ¨¡å¼** (Swarm - Mass Operations)
**åœºæ™¯**: æ‰¹é‡é‡æ„/è¿ç§»å¤šä¸ªç‹¬ç«‹æ–‡ä»¶
**åŠ é€Ÿæ¯”**: ~Nx

```
é‡æ„è®¡åˆ’ç¡®å®šå:
     â”‚
     â”œâ”€â”€â†’ [æ–—æˆ˜èƒœä½› A] é‡æ„ file_1.py  â”€â”€â”
     â”œâ”€â”€â†’ [æ–—æˆ˜èƒœä½› B] é‡æ„ file_2.py  â”€â”€â”¤
     â”œâ”€â”€â†’ [æ–—æˆ˜èƒœä½› C] é‡æ„ file_3.py  â”€â”€â”¼â”€â”€â†’ åˆå¹¶
     â””â”€â”€â†’ [æ–—æˆ˜èƒœä½› D] é‡æ„ file_4.py  â”€â”€â”˜

# å¬å”¤æ–¹å¼ (é™åˆ¶åŒæ—¶ 3-4 ä¸ªåˆ†èº«)
Task(subagent_type="general-purpose", prompt="é‡æ„ file_1", run_in_background=true)
Task(subagent_type="general-purpose", prompt="é‡æ„ file_2", run_in_background=true)
Task(subagent_type="general-purpose", prompt="é‡æ„ file_3", run_in_background=true)
```

### Parallelization Rules (å¹¶è¡Œè§„åˆ™)

#### âœ… å¯ä»¥å¹¶è¡Œçš„åœºæ™¯

| åœºæ™¯ | æ¨¡å¼ | æœ€å¤§å¹¶è¡Œæ•° |
|------|------|-----------|
| å®ç°å¤šä¸ªç‹¬ç«‹æ¨¡å— | åˆ†èº«ç¾¤æ”» | 3-4 |
| å®ç° + æ¢ç´¢å‚è€ƒ | ä¾¦å¯Ÿå…µ+ä¸»åŠ›å†› | 2 |
| å®ç° + å†™æµ‹è¯• (æ¥å£å·²å®š) | TDDé’³å½¢æ”»åŠ¿ | 2 |
| ä»£ç  + éƒ¨ç½²é…ç½® | ä»£ç +é…ç½®å¹¶è¡Œ | 2 |
| æ‰¹é‡æ–‡ä»¶ä¿®æ”¹ | èœ‚ç¾¤æ¨¡å¼ | 3-4 |
| å¤šæ–‡ä»¶ä»£ç å®¡æŸ¥ | å®¡æŸ¥åˆ†èº«ç¾¤ | 3-4 |
| å¤šæ¨¡å—ä»£ç æ¢ç´¢ | æ¢ç´¢åˆ†èº«ç¾¤ | 3-4 |

#### âŒ å¿…é¡»ä¸²è¡Œçš„åœºæ™¯

| åœºæ™¯ | åŸå›  |
|------|------|
| éœ€æ±‚ â†’ æ¶æ„ â†’ å®ç° | ä¾èµ–ä¸Šæ¸¸è¾“å‡º |
| ä¿®æ”¹åŒä¸€æ–‡ä»¶çš„å¤šä¸ªä»»åŠ¡ | ä¼šäº§ç”Ÿå†²çª |
| æµ‹è¯•ä¾èµ–æœªå®Œæˆçš„ä»£ç  | ä¼šå¤±è´¥ |
| éœ€è¦ç”¨æˆ·ç¡®è®¤çš„å†³ç­–ç‚¹ | é˜»å¡ç­‰å¾… |

### Parallel Execution Syntax (å¹¶è¡Œå¬å”¤è¯­æ³•)

**å…³é”®**: åœ¨**åŒä¸€æ¡æ¶ˆæ¯**ä¸­å‘é€å¤šä¸ª Task è°ƒç”¨

```python
# âœ… æ­£ç¡®: åŒä¸€æ¶ˆæ¯ä¸­å¤šä¸ª Task (å¹¶è¡Œæ‰§è¡Œ)
<message>
Task(subagent_type="general-purpose", prompt="ä»»åŠ¡A", run_in_background=true)
Task(subagent_type="general-purpose", prompt="ä»»åŠ¡B", run_in_background=true)
Task(subagent_type="general-purpose", prompt="ä»»åŠ¡C", run_in_background=true)
</message>

# âŒ é”™è¯¯: åˆ†å¼€å‘é€ (ä¸²è¡Œæ‰§è¡Œ)
<message>Task(...ä»»åŠ¡A...)</message>
<message>Task(...ä»»åŠ¡B...)</message>
<message>Task(...ä»»åŠ¡C...)</message>
```

### Resource Management (èµ„æºç®¡ç†)

```
å¹¶è¡Œåˆ†èº«é™åˆ¶:
â”œâ”€â”€ æœ€å¤§åŒæ—¶è¿è¡Œ: 3-4 ä¸ªåˆ†èº«
â”œâ”€â”€ åå°æ¢ç´¢: ä¸è®¡å…¥é™åˆ¶
â””â”€â”€ è¶…è¿‡é™åˆ¶æ—¶: æ‰¹æ¬¡æ‰§è¡Œ

ç¤ºä¾‹ (8ä¸ªç‹¬ç«‹æ¨¡å—):
â”œâ”€â”€ ç¬¬ä¸€æ‰¹: æ¨¡å— 1, 2, 3, 4 (å¹¶è¡Œ)
â”œâ”€â”€ ç­‰å¾…å®Œæˆ
â””â”€â”€ ç¬¬äºŒæ‰¹: æ¨¡å— 5, 6, 7, 8 (å¹¶è¡Œ)
```

### Merge Protocol (åˆå¹¶åè®®)

å¹¶è¡Œä»»åŠ¡å®Œæˆå:

```
1. æ”¶é›†æ‰€æœ‰åˆ†èº«çš„è¾“å‡º
2. æ£€æŸ¥æ˜¯å¦æœ‰å†²çª
3. å¦‚æœ‰å†²çª â†’ æ‰‹åŠ¨è§£å†³
4. è¿è¡Œå®Œæ•´éªŒè¯ (æ„å»º + æµ‹è¯•)
5. ç¡®è®¤æ— è¯¯åç»§ç»­
```

## Domain-Specific Patterns

### C++ Projects

```markdown
## Build & Test Commands
- Configure: cmake -B build -DCMAKE_BUILD_TYPE=Release
- Build: cmake --build build -j$(nproc)
- Test: ctest --test-dir build --output-on-failure
- Coverage: gcov/lcov

## Code Patterns
- RAII for resource management
- Smart pointers (unique_ptr, shared_ptr)
- Exception safety guarantees
- const correctness
```

### Python Projects

```markdown
## Build & Test Commands
- Install: pip install -e ".[dev]"
- Test: pytest -v --cov
- Lint: ruff check . && mypy .
- Format: ruff format .

## Code Patterns
- Type hints (Python 3.10+)
- Pydantic for data validation
- async/await for I/O
- Dependency injection
```

### FastAPI Projects

```markdown
## Structure
src/
â”œâ”€â”€ api/           # Route handlers
â”œâ”€â”€ core/          # Config, security
â”œâ”€â”€ models/        # Pydantic models
â”œâ”€â”€ services/      # Business logic
â””â”€â”€ repositories/  # Data access

## Patterns
- Dependency injection via Depends
- Async database operations
- Response models for validation
- OpenAPI documentation
```

### Video Processing

```markdown
## Libraries
- FFmpeg: transcoding, muxing
- GStreamer: pipeline processing
- OpenCV: frame analysis
- VAAPI/NVENC: hardware acceleration

## Patterns
- Zero-copy frame passing
- Pipeline parallelism
- Memory pool management
- Frame rate control
```

### AI Inference

```markdown
## Runtimes
- ONNX Runtime: cross-platform
- TensorRT: NVIDIA optimization
- OpenVINO: Intel optimization

## Patterns
- Batching for throughput
- Async inference
- Model versioning
- Input validation
```

## Workflow Tracks (åŠ¨æ€ç¼–æ’)

### Track A: Feature Development (The Waterfall)
**Trigger**: New features, massive changes.
**Flow**: `è€³(éœ€æ±‚) -> æ„(è®¾è®¡) -> æ–—æˆ˜èƒœä½›(å®ç°) + çœ¼(æ¢ç´¢) -> èˆŒ(æµ‹è¯•) -> é¼»(å®¡æŸ¥)`

### Track B: Bug Fix (The Surgical Strike)
**Trigger**: "Fix this error", "It's crashing".
**Flow**:
1. **Locate**: çœ¼åˆ†èº« finds the bug.
2. **Fix**: æ–—æˆ˜èƒœä½› applies the fix. (No `design.md` needed, just fix it).
3. **Verify**: èˆŒåˆ†èº« adds a regression case.

### Track C: Refactoring (The Renewal)
**Trigger**: "Cleanup", "Modernize", "Optimize".
**Flow**:
1. **Map**: çœ¼åˆ†èº« maps dependencies.
2. **Plan**: æ„åˆ†èº« creates a strategy (not full design).
3. **Execute**: æ–—æˆ˜èƒœä½› implements changes.
4. **Safety**: èˆŒåˆ†èº« verifies behavior.

### Stage 1: éœ€æ±‚è·å– (Requirement Gathering)

```
Input: ç”¨æˆ·è¯·æ±‚
Avatar: ğŸ‘‚ è€³åˆ†èº« (å¬)

Tasks:
1. è§£ææ˜¾å¼éœ€æ±‚
2. æ¨å¯¼éšå¼éœ€æ±‚
3. è¯†åˆ«è¾¹ç•Œæ¡ä»¶
4. ç¡®è®¤æŠ€æœ¯çº¦æŸ

Output: requirements.md
```

### Stage 2: æ–¹æ¡ˆè®¾è®¡ (Solution Design)

```
Input: requirements.md
Avatar: ğŸ§  æ„åˆ†èº« (æ€)

Tasks:
1. åˆ†æç°æœ‰æ¶æ„
2. è®¾è®¡è§£å†³æ–¹æ¡ˆ
3. æŠ€æœ¯é€‰å‹
4. è¯†åˆ«é£é™©

Output: design.md
```

### Stage 3: ä»£ç å®ç° (Implementation)

```
Input: design.md
Avatar: âš”ï¸ æ–—æˆ˜èƒœä½› (è¡Œ) + ğŸ‘ï¸ çœ¼åˆ†èº« (è§‚) (parallel)

Tasks:
1. çœ¼åˆ†èº«: ç ”ç©¶ç›¸å…³ä»£ç  (background)
2. æ–—æˆ˜èƒœä½›: æŒ‰è®¾è®¡å®ç°ä»£ç 
3. æœ¬ä½“: ç›‘ç£è¿›åº¦ï¼Œå›ç­”é—®é¢˜
4. å¢é‡éªŒè¯

Output: ä»£ç å˜æ›´
```

### Stage 4: æµ‹è¯•éªŒè¯ (Testing)

```
Input: ä»£ç å˜æ›´
Avatar: ğŸ‘… èˆŒåˆ†èº« (è¨€)

Tasks:
1. ç¼–å†™å•å…ƒæµ‹è¯•
2. ç¼–å†™é›†æˆæµ‹è¯•
3. éªŒè¯è¾¹ç•Œæ¡ä»¶
4. æ£€æŸ¥è¦†ç›–ç‡

Output: æµ‹è¯•é€šè¿‡
```

### Stage 5: ä»£ç å®¡æŸ¥ (Code Review)

```
Input: ä»£ç å˜æ›´ + æµ‹è¯•
Avatar: ğŸ‘ƒ é¼»åˆ†èº« (è§‰)

Tasks:
1. æ£€æŸ¥ä»£ç è´¨é‡
2. éªŒè¯è®¾è®¡ä¸€è‡´æ€§
3. è¯†åˆ«æ½œåœ¨é—®é¢˜
4. æå‡ºæ”¹è¿›å»ºè®®

Output: review.md
```

## Resume Protocol (ç»§ç»­åè®®)

| Scenario | Action |
|----------|--------|
| ä¸Šæ¬¡æœç´¢æœªå®Œæˆ | `resume: "<agent_id>"` |
| éœ€è¦è¡¥å……ä¹‹å‰çš„å‘ç° | `resume: "<agent_id>"` |
| å®Œå…¨ä¸åŒçš„ä»»åŠ¡ | é‡æ–°å¼€å§‹ |
| ä¸Šä¸‹æ–‡è¿‡æœŸ (>30 min) | é‡æ–°å¼€å§‹ |
