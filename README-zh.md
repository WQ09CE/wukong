# Wukong 悟空

> **六根并行生产，戒定慧识护航**

让 Claude Code 拥有记忆、学会反思、持续进化。

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

## 什么是 Wukong？

**Wukong 悟空** 是为 Claude Code 量身定制的多 Agent 协作框架。它将单一的 AI 助手转变为一个**分工明确、相互协作的工程团队**，并通过独创的**验证流水线**和**知识沉淀系统**，让 AI 助手越用越聪明。

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户                                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    悟空本体 (调度中心)                            │
│         任务拆解  ·  分身调度  ·  结果验证  ·  知识沉淀            │
└───────────────────────────┬─────────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            ▼               ▼               ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   六根分身系统    │ │   戒定验证流水线  │ │   慧识知识系统   │
│  并行协作执行     │ │  规则+证据双保险  │ │  反思+沉淀闭环   │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

---

## 三大核心亮点

### 1. 六根分身 - 多角色协同的工程解决方案

> 一个命令，自动拆解任务、并行执行、聚合结果

源自佛教"六根"概念，Wukong 将复杂工程任务分解给六个专业分身：

| 六根 | 分身 | 职责 | 擅长场景 |
|:----:|------|------|----------|
| 👁️ 眼 | 眼分身 | 观察·探索·搜索 | 代码库探索、文件搜索、依赖分析 |
| 👂 耳 | 耳分身 | 倾听·理解·需求 | 需求分析、边界澄清、验收标准 |
| 👃 鼻 | 鼻分身 | 感知·审查·检测 | 代码审查、安全扫描、规范检查 |
| 👅 舌 | 舌分身 | 表达·沟通·文档 | 测试编写、文档生成、API 说明 |
| ⚔️ 身 | 斗战胜佛 | 执行·实现·行动 | 代码实现、Bug 修复、功能开发 |
| 🧠 意 | 意分身 | 思考·设计·决策 | 架构设计、技术选型、方案评审 |

**智能调度特性：**
- **成本感知** - CHEAP 分身 10+ 并发后台执行，EXPENSIVE 分身阻塞保证质量
- **动态轨道** - Feature/Fix/Refactor 自动选择最优工作流
- **七十二变** - 支持自定义技能文件，无限扩展能力边界

```bash
# 显式指定分身
/wukong @眼 探索认证模块的实现
/wukong @意 设计缓存方案
/wukong @斗战胜佛 实现用户登录接口

# 自动轨道选择
/wukong 添加用户认证功能    # → Feature 轨道: 耳→意→身→舌→鼻
/wukong 修复登录失败的 bug  # → Fix 轨道: 眼→身→舌
```

---

### 2. 戒定双修 - 工程质量的双保险

> 告别"应该没问题"的幻觉，每个结论都有可验证的证据支撑

```
分身输出 ──→ 戒(规则检查) ──→ 定(可复现验证) ──→ 交付
              │                  │
              │                  └─ 证据等级判定
              │                     L0 推测 → ❌ 拒绝
              │                     L1 引用 → ⚠️ 条件接受
              │                     L2 本地验证 → ✅ 接受
              │                     L3 集成验证 → ✅✅ 完全信任
              │
              └─ Contract 完整性检查
                 Do/Don't 边界检查
                 安全敏感信息扫描
```

| 模块 | 职责 | 金规 |
|------|------|------|
| **戒** | 规则边界检查 | 违规即打回，不放水 |
| **定** | 可复现验证 | **没有证据 = 没有完成** |

**危险信号自动拦截：**
- "应该可以..." / "大概能..." → L0 推测，禁止通过
- "没有问题" / "应该没事" → 乐观偏见，需补充测试证据

---

### 3. 慧识循环 - 越用越聪明的记忆系统

> 反思 + 沉淀 = 持续进化的 AI 助手

```
工作过程 ──→ 慧(反思提取) ──→ 识(存储沉淀) ──→ 下次决策反馈
              │                  │                │
              │                  │                └─ 惯性提示注入
              │                  │                   历史决策 / 已知陷阱
              │                  │
              │                  └─ 锚点存储
              │                     [D] 决策 / [C] 约束
              │                     [P] 问题 / [M] 模式
              │
              └─ 末那识扫描
                 检测偏见 / 假设 / 盲点
```

| 能力 | 说明 |
|------|------|
| **跨会话记忆** | 多 session 隔离存储，用户级别知识沉淀 |
| **内观反思** | 任意时间跨度的工作回顾与总结 |
| **惯性提示** | 历史决策、已知陷阱自动注入新任务 |
| **三态压缩** | 巨→常→缩，智能管理上下文窗口 |

```bash
# 内观命令
/wukong 内观今天的工作      # 生成今日工作报告
/wukong 内观本周的工作      # 生成本周工作总结
/wukong 锚点               # 查看所有沉淀的决策/问题/模式
```

**用户价值：**
- 不重复踩坑 - 问题锚点 [P] 自动提醒
- 决策有迹可循 - 决策锚点 [D] 记录来龙去脉
- 模式可复用 - 模式锚点 [M] 跨项目沉淀

---

## 快速开始

### 安装

#### Linux / macOS

```bash
# 克隆仓库
git clone https://github.com/WQ09CE/wukong.git
cd wukong

# 安装到目标项目
./install.sh /path/to/your/project

# 或安装到当前目录
./install.sh
```

#### Windows (PowerShell)

```powershell
# 克隆仓库
git clone https://github.com/WQ09CE/wukong.git
cd wukong

# 安装到目标项目
.\install.ps1 -TargetDir "C:\path\to\your\project"

# 或安装到当前目录
.\install.ps1
```

> **提示：** 如果遇到执行策略错误，请运行：
> ```powershell
> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
> ```

安装脚本会：
1. 复制规则、技能、命令到项目的 `.claude/` 目录
2. 安装 hooks 到 `~/.wukong/hooks/`
3. 在 `~/.claude/settings.json` 中注册 PreCompact Hook（需确认）

### 使用

```bash
# 激活 Wukong
/wukong

# 开始工作
/wukong 添加用户登录功能
```

---

## 与其他方案的对比

| 特性 | 原生 Claude Code | Wukong |
|------|-----------------|--------|
| 任务执行 | 单一 Agent | 六根分身并行协作 |
| 输出验证 | 无 | 戒定双验证流水线 |
| 上下文管理 | 自动压缩丢失 | 三态压缩 + PreCompact 保存 |
| 跨会话记忆 | 无 | 锚点系统 + 惯性提示 |
| 自我反思 | 无 | 末那识扫描 + 内观命令 |
| 知识沉淀 | 无 | 决策/问题/模式持久化 |

---

## 项目结构

```
wukong/
├── wukong-dist/              # 分发源码
│   ├── rules/                # 核心规则 (戒)
│   ├── skills/               # 分身技能定义
│   ├── commands/             # 命令处理器
│   └── hooks/                # PreCompact Hook (慧)
│
├── install.sh                # 安装脚本 (Linux/macOS)
├── install.ps1               # 安装脚本 (Windows)
├── README.md                 # English README
└── README-zh.md              # 中文 README

# 安装后的用户目录
~/.wukong/
├── hooks/                    # 全局 hooks
└── context/                  # 知识存储 (识)
    ├── active/               # 活跃会话
    ├── sessions/             # 历史存档
    ├── anchors/              # 锚点存储
    └── index.json            # 会话索引
```

---

## 设计哲学

Wukong 的设计融合了东方哲学智慧：

- **六根** - 佛教中的六种感知器官，对应六个专业分身
- **戒定慧** - 佛教修行三学，对应验证流水线的三个阶段
- **识** - 唯识学中的"藏识"，对应知识存储系统
- **末那识** - 唯识学中的"执我"，对应偏见检测机制

---

## 参考项目

- [oh-my-opencode](https://github.com/code-yeongyu/oh-my-opencode)
- [claude-code-settings](https://github.com/feiskyer/claude-code-settings)

## License

MIT

---

<p align="center">
  <b>六根并行生产，戒定慧识护航</b><br>
  让 Claude Code 越用越好用，越用越聪明
</p>
