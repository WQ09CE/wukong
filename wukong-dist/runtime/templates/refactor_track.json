{
  "$schema": "../schema/taskgraph.schema.json",
  "id": "tg_refactor_template",
  "title": "Refactor Track Template",
  "track": "refactor",
  "status": "created",
  "nodes": [
    {
      "id": "eye_analyze",
      "title": "分析现状",
      "role": "eye",
      "executor": {
        "type": "subagent",
        "name": "眼分身"
      },
      "inputs": {
        "files": [],
        "context_refs": [],
        "upstream_outputs": []
      },
      "constraints": {
        "allowed_tools": ["Read", "Glob", "Grep", "Bash"],
        "time_budget_sec": 180,
        "cost_tier": "cheap",
        "background": "required"
      },
      "quality": {
        "evidence_level_required": "L1",
        "checklist": [
          "现有代码结构理解",
          "问题区域识别",
          "依赖关系梳理"
        ]
      },
      "status": "pending",
      "outputs": {}
    },
    {
      "id": "mind_plan",
      "title": "重构方案",
      "role": "mind",
      "executor": {
        "type": "subagent",
        "name": "意分身"
      },
      "inputs": {
        "files": [],
        "context_refs": [],
        "upstream_outputs": ["eye_analyze.summary"]
      },
      "constraints": {
        "allowed_tools": ["Read", "Glob", "Grep", "Write"],
        "time_budget_sec": 180,
        "cost_tier": "expensive",
        "background": "forbidden"
      },
      "quality": {
        "evidence_level_required": "L1",
        "checklist": [
          "重构策略明确",
          "风险评估完成",
          "回滚方案准备"
        ]
      },
      "status": "pending",
      "outputs": {}
    },
    {
      "id": "body_implement",
      "title": "执行重构",
      "role": "body",
      "executor": {
        "type": "subagent",
        "name": "斗战胜佛"
      },
      "inputs": {
        "files": [],
        "context_refs": [],
        "upstream_outputs": ["mind_plan.summary"]
      },
      "constraints": {
        "allowed_tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
        "time_budget_sec": 600,
        "cost_tier": "expensive",
        "background": "forbidden"
      },
      "quality": {
        "evidence_level_required": "L2",
        "checklist": [
          "重构完成",
          "代码编译通过",
          "功能保持一致"
        ]
      },
      "status": "pending",
      "outputs": {}
    },
    {
      "id": "nose_review",
      "title": "代码审查",
      "role": "nose",
      "executor": {
        "type": "subagent",
        "name": "鼻分身"
      },
      "inputs": {
        "files": [],
        "context_refs": [],
        "upstream_outputs": ["body_implement.summary"]
      },
      "constraints": {
        "allowed_tools": ["Read", "Glob", "Grep"],
        "time_budget_sec": 120,
        "cost_tier": "cheap",
        "background": "required"
      },
      "quality": {
        "evidence_level_required": "L1",
        "checklist": [
          "代码质量提升",
          "无新增技术债",
          "符合设计模式"
        ]
      },
      "status": "pending",
      "outputs": {}
    },
    {
      "id": "tongue_test",
      "title": "回归测试",
      "role": "tongue",
      "executor": {
        "type": "subagent",
        "name": "舌分身"
      },
      "inputs": {
        "files": [],
        "context_refs": [],
        "upstream_outputs": ["body_implement.summary"]
      },
      "constraints": {
        "allowed_tools": ["Read", "Bash", "Glob"],
        "time_budget_sec": 180,
        "cost_tier": "medium",
        "background": "optional"
      },
      "quality": {
        "evidence_level_required": "L2",
        "checklist": [
          "所有测试通过",
          "无功能回归",
          "性能无下降"
        ]
      },
      "status": "pending",
      "outputs": {}
    }
  ],
  "edges": [
    { "from": "eye_analyze", "to": "mind_plan", "condition": "on_success" },
    { "from": "mind_plan", "to": "body_implement", "condition": "on_success" },
    { "from": "body_implement", "to": "nose_review", "condition": "on_success" },
    { "from": "body_implement", "to": "tongue_test", "condition": "on_success" }
  ],
  "created_at": "2024-01-01T00:00:00Z",
  "metadata": {
    "description": "Refactor track: Eye (分析现状) → Mind (重构方案) → Body (执行重构) → [Nose + Tongue] (并行)",
    "phases": [
      { "phase": 0, "nodes": ["eye_analyze"], "parallel": false },
      { "phase": 1, "nodes": ["mind_plan"], "parallel": false },
      { "phase": 2, "nodes": ["body_implement"], "parallel": false },
      { "phase": 3, "nodes": ["nose_review", "tongue_test"], "parallel": true }
    ]
  }
}
