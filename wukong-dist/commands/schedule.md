# Schedule Command (è°ƒåº¦å‘½ä»¤)

> **æ™ºèƒ½è°ƒåº¦** - åˆ†æä»»åŠ¡ï¼Œè§„åˆ’æœ€ä¼˜æ‰§è¡Œè·¯å¾„
>
> **åˆ†å±‚è·¯ç”±**: L0 è§„åˆ™åŒ¹é… (0ms) â†’ L1 Haiku åˆ†èº« (~300ms, ä»…éœ€æ—¶)

## Usage (ä½¿ç”¨æ–¹å¼)

```
/schedule <ä»»åŠ¡æè¿°>
/schedule --dry-run <ä»»åŠ¡æè¿°>    # åªåˆ†æä¸æ‰§è¡Œ
/schedule --force-llm <ä»»åŠ¡æè¿°>  # å¼ºåˆ¶ä½¿ç”¨ Haiku åˆ†èº«
```

## Two-Layer Routing Architecture

```
ç”¨æˆ·ä»»åŠ¡
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L0: Python è§„åˆ™åŒ¹é… (0ms)           â”‚
â”‚  - @ è¯­æ³•è§£æ                        â”‚
â”‚  - å…³é”®è¯åŒ¹é…                        â”‚
â”‚  - è¿”å› track + confidence          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
confidence >= 0.7? â”€â”€YESâ”€â”€â†’ ç›´æ¥è¾“å‡ºç»“æœ
    â”‚
    NO (needs_llm=true)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1: Haiku è°ƒåº¦åˆ†èº« (~300ms)         â”‚
â”‚  - Task(model="haiku")              â”‚
â”‚  - ç²¾ç¡®åˆ†ç±» + å¤æ‚åº¦åˆ¤æ–­             â”‚
â”‚  - è¿”å› track + complexity + phases â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¾“å‡ºæœ€ç»ˆç»“æœ
```

## Execution Steps

### Step 1: L0 è§„åˆ™åŒ¹é…

è¿è¡Œ Python CLI è¿›è¡Œå¿«é€Ÿåˆ†æ:

```bash
python3 ~/.wukong/runtime/cli.py analyze "{user_task}"
```

è§£æè¿”å›çš„ JSON:
- `track`: è½¨é“ (fix/feature/refactor/direct)
- `confidence`: ç½®ä¿¡åº¦ (0.0-1.0)
- `needs_llm`: æ˜¯å¦éœ€è¦è°ƒç”¨ Haiku åˆ†èº«
- `phases`: æ‰§è¡Œé˜¶æ®µ

### Step 2: åˆ¤æ–­æ˜¯å¦éœ€è¦ L1

**è·³è¿‡ L1 çš„æ¡ä»¶**:
- `confidence >= 0.7`
- ç”¨æˆ·æœªæŒ‡å®š `--force-llm`

**éœ€è¦ L1 çš„æ¡ä»¶**:
- `confidence < 0.7` (needs_llm=true)
- ç”¨æˆ·æŒ‡å®š `--force-llm`

### Step 3: L1 Haiku è°ƒåº¦åˆ†èº« (å¦‚éœ€)

å¦‚æœéœ€è¦ L1ï¼Œå¬å”¤ Haiku è°ƒåº¦åˆ†èº«:

```
å¬å”¤ Haiku è°ƒåº¦åˆ†èº«:
- åˆ†èº«: scheduler (è°ƒåº¦åˆ†èº«)
- æ¨¡å‹: haiku
- åŸå› : L0 ç½®ä¿¡åº¦ä¸è¶³ï¼Œéœ€è¦æ›´ç²¾ç¡®çš„ä»»åŠ¡åˆ†ç±»
- æŠ€èƒ½: è¯»å– scheduler.md skill
- é¢„æœŸ: JSON æ ¼å¼çš„ {track, complexity, confidence, reasoning, phases}
```

**Task å·¥å…·è°ƒç”¨**:
```json
{
  "subagent_type": "haiku",
  "model": "haiku",
  "prompt": "ä½ æ˜¯ Wukong çš„è°ƒåº¦åˆ†èº«...\n\nTASK: {user_task}\nL0_RESULT: {l0_result_json}\n\nè¯·åˆ†æä»»åŠ¡å¹¶è¾“å‡º JSON æ ¼å¼çš„è°ƒåº¦ç»“æœã€‚"
}
```

**Haiku åˆ†èº« Prompt æ¨¡æ¿**:
```
ä½ æ˜¯ Wukong çš„è°ƒåº¦åˆ†èº« - ä¸“é—¨è´Ÿè´£åˆ†æä»»åŠ¡å¹¶é€‰æ‹©æœ€ä½³æ‰§è¡Œè½¨é“ã€‚

## Input
TASK: {user_task}
L0_RESULT: {l0_result_json}

## Output Format
è¾“å‡ºä»¥ä¸‹ JSON æ ¼å¼ï¼ˆæ— å…¶ä»–æ–‡å­—ï¼‰:
{
  "track": "feature|fix|refactor|research|direct",
  "complexity": "simple|medium|complex",
  "confidence": 0.0-1.0,
  "reasoning": "ç®€çŸ­ç†ç”±",
  "phases": [
    {"phase": 0, "nodes": ["agent1", "agent2"], "parallel": true},
    {"phase": 1, "nodes": ["agent3"], "parallel": false}
  ]
}

## Track Definitions
- feature: æ·»åŠ æ–°åŠŸèƒ½ã€å®ç°æ–°ç‰¹æ€§
- fix: ä¿®å¤ bugã€è§£å†³é—®é¢˜
- refactor: é‡æ„ã€ä¼˜åŒ–ã€æ¸…ç†ä»£ç 
- research: æ¢ç´¢ã€è°ƒç ”ã€äº†è§£ä»£ç 
- direct: ç®€å•æ“ä½œã€å•è¡Œä¿®æ”¹

## Complexity Definitions
- simple: å•æ–‡ä»¶ã€<50è¡Œæ”¹åŠ¨
- medium: 2-3ä¸ªæ–‡ä»¶ã€ä¸­ç­‰æ”¹åŠ¨
- complex: 4+æ–‡ä»¶ã€æ¶æ„å˜æ›´

## Agent Nodes
- eye_explore: çœ¼åˆ†èº« (æ¢ç´¢)
- ear_understand: è€³åˆ†èº« (éœ€æ±‚)
- nose_analyze / nose_review: é¼»åˆ†èº« (åˆ†æ/å®¡æŸ¥)
- tongue_verify: èˆŒåˆ†èº« (æµ‹è¯•)
- body_implement: æ–—æˆ˜èƒœä½› (å®ç°)
- mind_design: æ„åˆ†èº« (è®¾è®¡)
```

### Step 4: è¾“å‡ºç»“æœ

è¾“å‡ºä»¥ä¸‹ Markdown æ ¼å¼:

```markdown
## è°ƒåº¦åˆ†æç»“æœ

### è·¯ç”±ä¿¡æ¯
- **è·¯ç”±å±‚çº§**: {L0 / L1}
- **ç½®ä¿¡åº¦**: {confidence}%

### ä»»åŠ¡ä¿¡æ¯
- **æè¿°**: {task_description}
- **æ£€æµ‹è½¨é“**: {track} (Feature/Fix/Refactor/Research/Direct)
- **å¤æ‚åº¦**: {complexity} (å¦‚æœ‰)

### æ‰§è¡Œè®¡åˆ’

| Phase | åˆ†èº« | å¹¶è¡Œ | è¯´æ˜ |
|-------|------|------|------|
| 0 | ğŸ‘ï¸ çœ¼ + ğŸ‘‚ è€³ | æ˜¯ | æ¢ç´¢ + éœ€æ±‚ç†è§£ |
| 1 | ğŸ§  æ„ | å¦ | æ¶æ„è®¾è®¡ |
| 2 | âš”ï¸ èº« | å¦ | ä»£ç å®ç° |
| 3 | ğŸ‘… èˆŒ + ğŸ‘ƒ é¼» | æ˜¯ | æµ‹è¯• + å®¡æŸ¥ |

### å»ºè®®æ“ä½œ
{æ ¹æ®åˆ†æç»™å‡ºå»ºè®®}
```

## Now Execute

è¯»å–ç”¨æˆ·è¾“å…¥çš„ä»»åŠ¡æè¿°ï¼Œæ‰§è¡Œä»¥ä¸‹æµç¨‹:

1. **è§£æå‚æ•°**
   - `--dry-run`: åªè¾“å‡ºåˆ†æï¼Œä¸å»ºè®®æ‰§è¡Œ
   - `--force-llm`: å¼ºåˆ¶ä½¿ç”¨ Haiku åˆ†èº«
   - æ— å‚æ•°: è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ L1

2. **è¿è¡Œ L0 åˆ†æ**
   ```bash
   python3 ~/.wukong/runtime/cli.py analyze "{user_task}"
   ```

3. **åˆ¤æ–­æ˜¯å¦éœ€è¦ L1**
   - å¦‚æœ `needs_llm=true` æˆ– `--force-llm`
   - åˆ™å¬å”¤ Haiku è°ƒåº¦åˆ†èº« (ä½¿ç”¨ Task å·¥å…·)

4. **æ ¼å¼åŒ–è¾“å‡º**
   - ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ Markdown æ ¼å¼
   - åŒ…å«è·¯ç”±å±‚çº§ä¿¡æ¯

## Scheduler Configuration Reference

### åˆ†èº«æˆæœ¬é…ç½®

| åˆ†èº« | æˆæœ¬ | æ¨¡å‹ | æœ€å¤§å¹¶å‘ | åå° |
|------|------|------|---------|------|
| ğŸ‘ï¸ çœ¼ | CHEAP | haiku | 10+ | å¿…é¡» |
| ğŸ‘‚ è€³ | CHEAP | haiku | 10+ | å¯é€‰ |
| ğŸ‘ƒ é¼» | CHEAP | haiku | 5+ | å¿…é¡» |
| ğŸ‘… èˆŒ | MEDIUM | sonnet | 3 | å¯é€‰ |
| âš”ï¸ èº« | EXPENSIVE | sonnet | 1 | ç¦æ­¢ |
| ğŸ§  æ„ | EXPENSIVE | opus | 1 | ç¦æ­¢ |

### è½¨é“ DAG

**Feature**: è€³+çœ¼ â†’ æ„ â†’ èº« â†’ èˆŒ+é¼»
**Fix**: çœ¼+é¼» â†’ èº« â†’ èˆŒ
**Refactor**: çœ¼ â†’ æ„ â†’ èº« â†’ é¼»+èˆŒ
**Research**: çœ¼
**Direct**: ç›´æ¥æ‰§è¡Œ

## Error Handling

- å¦‚æœ Python CLI ä¸å­˜åœ¨ï¼Œæç¤ºæ£€æŸ¥ `~/.wukong/runtime/` ç›®å½•
- å¦‚æœ Haiku åˆ†èº«è¿”å›é JSONï¼Œå°è¯•æå– JSON éƒ¨åˆ†
- å¦‚æœä»»åŠ¡æè¿°ä¸ºç©ºï¼Œæç¤ºç”¨æˆ·æä¾›ä»»åŠ¡

---

**å°±ç»ª**ï¼è¯·æä¾›ä»»åŠ¡æè¿°ï¼Œæˆ‘å°†åˆ†æå¹¶ç”Ÿæˆæœ€ä¼˜è°ƒåº¦è®¡åˆ’ã€‚
